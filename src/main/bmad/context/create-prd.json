[
  {
    "id": "c42c921e-d283-40fd-bfc9-e9431f5ae7bd",
    "role": "user",
    "content": "IT IS CRITICAL THAT YOU FOLLOW THIS COMMAND: LOAD the FULL _bmad/bmm/workflows/2-plan-workflows/create-prd/workflow.md, READ its entire contents and follow its directions exactly!\n\nCreate PRD.",
    "promptContext": {
      "id": "c42c921e-d283-40fd-bfc9-e9431f5ae7bd",
      "group": {
        "id": "c42c921e-d283-40fd-bfc9-e9431f5ae7bd"
      }
    }
  },
  {
    "role": "assistant",
    "content": [
      {
        "type": "tool-call",
        "toolCallId": "tool_FXeLRrXqGuYA8P4OOWOTeHrD",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/workflows/2-plan-workflows/create-prd/workflow.md",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "id": "d7cfdd71-3513-4223-9b10-b4c995f028a4",
    "promptContext": {
      "id": "c42c921e-d283-40fd-bfc9-e9431f5ae7bd",
      "group": {
        "id": "c42c921e-d283-40fd-bfc9-e9431f5ae7bd"
      }
    }
  },
  {
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "tool_FXeLRrXqGuYA8P4OOWOTeHrD",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": "---\nname: create-prd\ndescription: PRD tri-modal workflow - Create, Validate, or Edit comprehensive PRDs\nmain_config: '{project-root}/_bmad/bmm/config.yaml'\nnextStep: './steps-c/step-01-init.md'\nvalidateWorkflow: './steps-v/step-v-01-discovery.md'\neditWorkflow: './steps-e/step-e-01-discovery.md'\nweb_bundle: true\n---\n\n# PRD Workflow (Tri-Modal)\n\n**Goal:** Create, Validate, or Edit comprehensive PRDs through structured workflows.\n\n**Your Role:**\n- **Create Mode:** Product-focused PM facilitator collaborating with an expert peer\n- **Validate Mode:** Validation Architect and Quality Assurance Specialist\n- **Edit Mode:** PRD improvement specialist\n\nYou will continue to operate with your given name, identity, and communication_style, merged with the details of this role description.\n\n---\n\n## MODE DETERMINATION\n\n### Detect Workflow Mode\n\nDetermine which mode to invoke based on:\n\n1. **Command/Invocation:**\n   - \"create prd\" or \"new prd\" ‚Üí Create mode\n   - \"validate prd\" or \"check prd\" ‚Üí Validate mode\n   - \"edit prd\" or \"improve prd\" ‚Üí Edit mode\n\n2. **Context Detection:**\n   - If invoked with -c flag ‚Üí Create mode\n   - If invoked with -v flag ‚Üí Validate mode\n   - If invoked with -e flag ‚Üí Edit mode\n\n3. **Menu Selection (if unclear):**\n\nIf mode cannot be determined from invocation:\n\"**PRD Workflow - Select Mode:**\n\n**[C] Create** - Create a new PRD from scratch\n**[V] Validate** - Validate an existing PRD against BMAD standards\n**[E] Edit** - Improve an existing PRD\n\nWhich mode would you like?\"\n\nWait for user selection.\n\n### Route to Appropriate Workflow\n\n**IF Create Mode:**\n\"**Create Mode: Creating a new PRD from scratch.**\"\nRead fully and follow: `{nextStep}` (steps-c/step-01-init.md)\n\n**IF Validate Mode:**\n\"**Validate Mode: Validating an existing PRD against BMAD standards.**\"\nPrompt for PRD path: \"Which PRD would you like to validate? Please provide the path to the PRD.md file.\"\nThen read fully and follow: `{validateWorkflow}` (steps-v/step-v-01-discovery.md)\n\n**IF Edit Mode:**\n\"**Edit Mode: Improving an existing PRD.**\"\nPrompt for PRD path: \"Which PRD would you like to edit? Please provide the path to the PRD.md file.\"\nThen read fully and follow: `{editWorkflow}` (steps-e/step-e-01-discovery.md)\n\n---\n\n## WORKFLOW ARCHITECTURE\n\nThis uses **step-file architecture** for disciplined execution:\n\n### Core Principles\n\n- **Micro-file Design**: Each step is a self contained instruction file that is a part of an overall workflow that must be followed exactly\n- **Just-In-Time Loading**: Only the current step file is in memory - never load future step files until told to do so\n- **Sequential Enforcement**: Sequence within the step files must be completed in order, no skipping or optimization allowed\n- **State Tracking**: Document progress in output file frontmatter using `stepsCompleted` array when a workflow produces a document\n- **Append-Only Building**: Build documents by appending content as directed to the output file\n\n### Step Processing Rules\n\n1. **READ COMPLETELY**: Always read the entire step file before taking any action\n2. **FOLLOW SEQUENCE**: Execute all numbered sections in order, never deviate\n3. **WAIT FOR INPUT**: If a menu is presented, halt and wait for user selection\n4. **CHECK CONTINUATION**: If the step has a menu with Continue as an option, only proceed to next step when user selects 'C' (Continue)\n5. **SAVE STATE**: Update `stepsCompleted` in frontmatter before loading next step\n6. **LOAD NEXT**: When directed, read fully and follow the next step file\n\n### Critical Rules (NO EXCEPTIONS)\n\n- üõë **NEVER** load multiple step files simultaneously\n- üìñ **ALWAYS** read entire step file before execution\n- üö´ **NEVER** skip steps or optimize the sequence\n- üíæ **ALWAYS** update frontmatter of output files when writing the final output for a specific step\n- üéØ **ALWAYS** follow the exact instructions in the step file\n- ‚è∏Ô∏è **ALWAYS** halt at menus and wait for user input\n- üìã **NEVER** create mental todo lists from future steps\n\n---\n\n## INITIALIZATION SEQUENCE\n\n### 1. Mode Determination\n\n**Check if mode was specified in the command invocation:**\n\n- If user invoked with \"create prd\" or \"new prd\" or \"build prd\" or \"-c\" or \"--create\" ‚Üí Set mode to **create**\n- If user invoked with \"validate prd\" or \"review prd\" or \"check prd\" or \"-v\" or \"--validate\" ‚Üí Set mode to **validate**\n- If user invoked with \"edit prd\" or \"modify prd\" or \"improve prd\" or \"-e\" or \"--edit\" ‚Üí Set mode to **edit**\n\n**If mode is still unclear, ask user:**\n\n\"**PRD Workflow - Select Mode:**\n\n**[C] Create** - Create a new PRD from scratch\n**[V] Validate** - Validate an existing PRD against BMAD standards\n**[E] Edit** - Improve an existing PRD\n\nWhich mode would you like?\"\n\nWait for user selection.\n\n### 2. Configuration Loading\n\nLoad and read full config from {main_config} and resolve:\n\n- `project_name`, `output_folder`, `planning_artifacts`, `user_name`\n- `communication_language`, `document_output_language`, `user_skill_level`\n- `date` as system-generated current datetime\n\n‚úÖ YOU MUST ALWAYS SPEAK OUTPUT In your Agent communication style with the configured `{communication_language}`.\n\n### 3. Route to Appropriate Workflow\n\n**IF mode == create:**\n\"**Create Mode: Creating a new PRD from scratch.**\"\nRead fully and follow: `{nextStep}` (steps-c/step-01-init.md)\n\n**IF mode == validate:**\n\"**Validate Mode: Validating an existing PRD against BMAD standards.**\"\nPrompt for PRD path: \"Which PRD would you like to validate? Please provide the path to the PRD.md file.\"\nThen read fully and follow: `{validateWorkflow}` (steps-v/step-v-01-discovery.md)\n\n**IF mode == edit:**\n\"**Edit Mode: Improving an existing PRD.**\"\nPrompt for PRD path: \"Which PRD would you like to edit? Please provide the path to the PRD.md file.\"\nThen read fully and follow: `{editWorkflow}` (steps-e/step-e-01-discovery.md)\n"
        }
      }
    ],
    "id": "d4d14230-9f22-4ca5-aa7c-cef9c4e36c5e",
    "promptContext": {
      "id": "c42c921e-d283-40fd-bfc9-e9431f5ae7bd",
      "group": {
        "id": "c42c921e-d283-40fd-bfc9-e9431f5ae7bd"
      }
    }
  },
  {
    "role": "assistant",
    "content": [
      {
        "type": "tool-call",
        "toolCallId": "tool_LgMFbKXOMN0ZMoCCyREaOgSw",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/config.yaml",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "id": "59fb3854-d6af-427e-8ad5-c73ba5a6d028",
    "promptContext": {
      "id": "c42c921e-d283-40fd-bfc9-e9431f5ae7bd",
      "group": {
        "id": "c42c921e-d283-40fd-bfc9-e9431f5ae7bd"
      }
    }
  },
  {
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "tool_LgMFbKXOMN0ZMoCCyREaOgSw",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": "# BMM Module Configuration\n# Generated by BMAD installer\n# Version: 6.0.0-Beta.5\n# Date: 2026-02-03T14:30:35.442Z\n\nproject_name: aider-desk\nuser_skill_level: intermediate\nplanning_artifacts: \"{project-root}/_bmad-output/planning-artifacts\"\nimplementation_artifacts: \"{project-root}/_bmad-output/implementation-artifacts\"\nproject_knowledge: \"{project-root}/docs\"\n\n# Core Configuration Values\nuser_name: Wlad\ncommunication_language: English\ndocument_output_language: English\noutput_folder: \"{project-root}/_bmad-output\"\n"
        }
      }
    ],
    "id": "6a609d18-116e-4227-98f3-5154d2b99bde",
    "promptContext": {
      "id": "c42c921e-d283-40fd-bfc9-e9431f5ae7bd",
      "group": {
        "id": "c42c921e-d283-40fd-bfc9-e9431f5ae7bd"
      }
    }
  },
  {
    "role": "assistant",
    "content": [
      {
        "type": "tool-call",
        "toolCallId": "tool_6NQsKIO7dYij9H2aIX6ffEiD",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/workflows/2-plan-workflows/create-prd/steps-c/step-01-init.md",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "id": "9726f399-f671-4b02-baa2-3e517ad92562",
    "promptContext": {
      "id": "c42c921e-d283-40fd-bfc9-e9431f5ae7bd",
      "group": {
        "id": "c42c921e-d283-40fd-bfc9-e9431f5ae7bd"
      }
    }
  },
  {
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "tool_6NQsKIO7dYij9H2aIX6ffEiD",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": "---\nname: 'step-01-init'\ndescription: 'Initialize the PRD workflow by detecting continuation state and setting up the document'\n\n# File References\nnextStepFile: './step-02-discovery.md'\ncontinueStepFile: './step-01b-continue.md'\noutputFile: '{planning_artifacts}/prd.md'\n\n# Template Reference\nprdTemplate: '../templates/prd-template.md'\n---\n\n# Step 1: Workflow Initialization\n\n**Progress: Step 1 of 11** - Next: Project Discovery\n\n## STEP GOAL:\n\nInitialize the PRD workflow by detecting continuation state, discovering input documents, and setting up the document structure for collaborative product requirement discovery.\n\n## MANDATORY EXECUTION RULES (READ FIRST):\n\n### Universal Rules:\n\n- üõë NEVER generate content without user input\n- üìñ CRITICAL: Read the complete step file before taking any action\n- üîÑ CRITICAL: When loading next step with 'C', ensure entire file is read\n- üìã YOU ARE A FACILITATOR, not a content generator\n- ‚úÖ YOU MUST ALWAYS SPEAK OUTPUT In your Agent communication style with the config `{communication_language}`\n\n### Role Reinforcement:\n\n- ‚úÖ You are a product-focused PM facilitator collaborating with an expert peer\n- ‚úÖ If you already have been given a name, communication_style and persona, continue to use those while playing this new role\n- ‚úÖ We engage in collaborative dialogue, not command-response\n- ‚úÖ You bring structured thinking and facilitation skills, while the user brings domain expertise and product vision\n\n### Step-Specific Rules:\n\n- üéØ Focus only on initialization and setup - no content generation yet\n- üö´ FORBIDDEN to look ahead to future steps or assume knowledge from them\n- üí¨ Approach: Systematic setup with clear reporting to user\n- üö™ Detect existing workflow state and handle continuation properly\n\n## EXECUTION PROTOCOLS:\n\n- üéØ Show your analysis of current state before taking any action\n- üíæ Initialize document structure and update frontmatter appropriately\n- Update frontmatter: add this step name to the end of the steps completed array (it should be the first entry in the steps array since this is step 1)\n- üö´ FORBIDDEN to load next step until user selects 'C' (Continue)\n\n## CONTEXT BOUNDARIES:\n\n- Available context: Variables from workflow.md are available in memory\n- Focus: Workflow initialization and document setup only\n- Limits: Don't assume knowledge from other steps or create content yet\n- Dependencies: Configuration loaded from workflow.md initialization\n\n## Sequence of Instructions (Do not deviate, skip, or optimize)\n\n### 1. Check for Existing Workflow State\n\nFirst, check if the output document already exists:\n\n**Workflow State Detection:**\n\n- Look for file at `{outputFile}`\n- If exists, read the complete file including frontmatter\n- If not exists, this is a fresh workflow\n\n### 2. Handle Continuation (If Document Exists)\n\nIf the document exists and has frontmatter with `stepsCompleted` BUT `step-11-complete` is NOT in the list, follow the Continuation Protocol since the document is incomplete:\n\n**Continuation Protocol:**\n\n- **STOP immediately** and load `{continueStepFile}`\n- Do not proceed with any initialization tasks\n- Let step-01b handle all continuation logic\n- This is an auto-proceed situation - no user choice needed\n\n### 3. Fresh Workflow Setup (If No Document)\n\nIf no document exists or no `stepsCompleted` in frontmatter:\n\n#### A. Input Document Discovery\n\nDiscover and load context documents using smart discovery. Documents can be in the following locations:\n- {planning_artifacts}/**\n- {output_folder}/**\n- {product_knowledge}/**\n- docs/**\n\nAlso - when searching - documents can be a single markdown file, or a folder with an index and multiple files. For Example, if searching for `*foo*.md` and not found, also search for a folder called *foo*/index.md (which indicates sharded content)\n\nTry to discover the following:\n- Product Brief (`*brief*.md`)\n- Research Documents (`/*research*.md`)\n- Project Documentation (generally multiple documents might be found for this in the `{product_knowledge}` or `docs` folder.)\n- Project Context (`**/project-context.md`)\n\n<critical>Confirm what you have found with the user, along with asking if the user wants to provide anything else. Only after this confirmation will you proceed to follow the loading rules</critical>\n\n**Loading Rules:**\n\n- Load ALL discovered files completely that the user confirmed or provided (no offset/limit)\n- If there is a project context, whatever is relevant should try to be biased in the remainder of this whole workflow process\n- For sharded folders, load ALL files to get complete picture, using the index first to potentially know the potential of each document\n- index.md is a guide to what's relevant whenever available\n- Track all successfully loaded files in frontmatter `inputDocuments` array\n\n#### B. Create Initial Document\n\n**Document Setup:**\n\n- Copy the template from `{prdTemplate}` to `{outputFile}`\n- Initialize frontmatter with proper structure including inputDocuments array.\n\n#### C. Present Initialization Results\n\n**Setup Report to User:**\n\n\"Welcome {{user_name}}! I've set up your PRD workspace for {{project_name}}.\n\n**Document Setup:**\n\n- Created: `{outputFile}` from template\n- Initialized frontmatter with workflow state\n\n**Input Documents Discovered:**\n\n- Product briefs: {{briefCount}} files {if briefCount > 0}‚úì loaded{else}(none found){/if}\n- Research: {{researchCount}} files {if researchCount > 0}‚úì loaded{else}(none found){/if}\n- Brainstorming: {{brainstormingCount}} files {if brainstormingCount > 0}‚úì loaded{else}(none found){/if}\n- Project docs: {{projectDocsCount}} files {if projectDocsCount > 0}‚úì loaded (brownfield project){else}(none found - greenfield project){/if}\n\n**Files loaded:** {list of specific file names or \"No additional documents found\"}\n\n{if projectDocsCount > 0}\nüìã **Note:** This is a **brownfield project**. Your existing project documentation has been loaded. In the next step, I'll ask specifically about what new features or changes you want to add to your existing system.\n{/if}\n\nDo you have any other documents you'd like me to include, or shall we continue to the next step?\"\n\n### 4. Present MENU OPTIONS\n\nDisplay menu after setup report:\n\n\"[C] Continue - Save this and move to Project Discovery (Step 2 of 11)\"\n\n#### Menu Handling Logic:\n\n- IF C: Update output file frontmatter, adding this step name to the end of the list of stepsCompleted, then read fully and follow: {nextStepFile}\n- IF user provides additional files: Load them, update inputDocuments and documentCounts, redisplay report\n- IF user asks questions: Answer and redisplay menu\n\n#### EXECUTION RULES:\n\n- ALWAYS halt and wait for user input after presenting menu\n- ONLY proceed to next step when user selects 'C'\n\n## CRITICAL STEP COMPLETION NOTE\n\nONLY WHEN [C continue option] is selected and [frontmatter properly updated with this step added to stepsCompleted and documentCounts], will you then read fully and follow: `{nextStepFile}` to begin project discovery.\n\n---\n\n## üö® SYSTEM SUCCESS/FAILURE METRICS\n\n### ‚úÖ SUCCESS:\n\n- Existing workflow detected and properly handed off to step-01b\n- Fresh workflow initialized with template and proper frontmatter\n- Input documents discovered and loaded using sharded-first logic\n- All discovered files tracked in frontmatter `inputDocuments`\n- User clearly informed of brownfield vs greenfield status\n- Menu presented and user input handled correctly\n- Frontmatter updated with this step name added to stepsCompleted before proceeding\n\n### ‚ùå SYSTEM FAILURE:\n\n- Proceeding with fresh initialization when existing workflow exists\n- Not updating frontmatter with discovered input documents\n- **Not storing document counts in frontmatter**\n- Creating document without proper template structure\n- Not checking sharded folders first before whole files\n- Not reporting discovered documents to user clearly\n- Proceeding without user selecting 'C' (Continue)\n\n**Master Rule:** Skipping steps, optimizing sequences, or not following exact instructions is FORBIDDEN and constitutes SYSTEM FAILURE.\n"
        }
      }
    ],
    "id": "84eb696f-4a5e-4534-960b-91630c5fabd6",
    "promptContext": {
      "id": "c42c921e-d283-40fd-bfc9-e9431f5ae7bd",
      "group": {
        "id": "c42c921e-d283-40fd-bfc9-e9431f5ae7bd",
        "name": "Create PRD",
        "color": "#22c55e",
        "finished": true
      }
    }
  },
  {
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "**Create Mode: Creating a new PRD from scratch.**\n\nLet me check for existing workflow state and discover input documents."
      }
    ],
    "id": "335abfa5-f996-4663-a67b-798e5894acad",
    "promptContext": {
      "id": "c42c921e-d283-40fd-bfc9-e9431f5ae7bd"
    }
  }
]
